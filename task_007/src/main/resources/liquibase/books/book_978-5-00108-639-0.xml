<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

    <changeSet id="1.0.1-Book_978-5-00108-639-0" author="aelshin">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT
                  COUNT(BOOKID)
                FROM
                  LIB_BOOKS
                WHERE
                  ISBN = '978-5-00108-639-0'
            </sqlCheck>
        </preConditions>

        <insert tableName="LIB_BOOKS">
            <column name="BOOKID" valueComputed="nextval('LIB_BOOKS_SEQ')"/>
            <column name="TITLE">Русские волшебные сказки</column>
            <column name="ISBN">978-5-00108-639-0</column>
            <column name="DESCRIPTION">В сборник вошли известные и любимые всеми сказки: «Аленький цветочек» С. Т. Аксакова, «Спящая царевна» В. А. Жуковского, «Сказка о рыбаке и рыбке» А. С. Пушкина. Иллюстрации Бориса Александровича Дехтерёва обладают своим особым, неповторимым шармом и прекрасно дополняют волшебный мир, созданный русскими писателями. Художник не просто нарисовал изящные картины, он в присущем лишь ему одному стиле передал объём и движение при помощи цвета и тени.</column>
        </insert>

    </changeSet>

    <changeSet id="1.0.1-BookGenreLink_978-5-00108-639-0_1" author="aelshin">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT
                  COUNT(*)
                FROM
                  LIB_BOOKGENRELINKS
                WHERE 1=1
                  AND BOOKID in (select BOOKID from LIB_BOOKS where ISBN = '978-5-00108-639-0')
                  AND GENREID in (select GENREID from LIB_GENRES where NAME = 'Сказка')
            </sqlCheck>
        </preConditions>

        <insert tableName="LIB_BOOKGENRELINKS">
            <column name="BOOKID" valueComputed="(select BOOKID from LIB_BOOKS where ISBN = '978-5-00108-639-0')"/>
            <column name="GENREID" valueComputed="(select GENREID from LIB_GENRES where NAME = 'Сказка')"/>
        </insert>

    </changeSet>

    <changeSet id="1.0.1-BookAuthorLink_978-5-00108-639-0_1" author="aelshin">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT
                  COUNT(*)
                FROM
                  LIB_BOOKAUTHORLINKS
                WHERE 1=1
                  AND BOOKID in (select BOOKID from LIB_BOOKS where ISBN = '978-5-00108-639-0')
                  AND AUTHORID in (select AUTHORID from LIB_AUTHORS where LASTNAME = 'Пушкин' AND FIRSTNAME = 'Александр' AND MIDDLENAME = 'Сергеевич')
            </sqlCheck>
        </preConditions>

        <insert tableName="LIB_BOOKAUTHORLINKS">
            <column name="BOOKID" valueComputed="(select BOOKID from LIB_BOOKS where ISBN = '978-5-00108-639-0')"/>
            <column name="AUTHORID" valueComputed="(select AUTHORID from LIB_AUTHORS where LASTNAME = 'Пушкин' AND FIRSTNAME = 'Александр' AND MIDDLENAME = 'Сергеевич')"/>
        </insert>

    </changeSet>

    <changeSet id="1.0.1-BookAuthorLink_978-5-00108-639-0_2" author="aelshin">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT
                  COUNT(*)
                FROM
                  LIB_BOOKAUTHORLINKS
                WHERE 1=1
                  AND BOOKID in (select BOOKID from LIB_BOOKS where ISBN = '978-5-00108-639-0')
                  AND AUTHORID in (select AUTHORID from LIB_AUTHORS where LASTNAME = 'Жуковский' AND FIRSTNAME = 'Василий' AND MIDDLENAME = 'Андреевич')
            </sqlCheck>
        </preConditions>

        <insert tableName="LIB_BOOKAUTHORLINKS">
            <column name="BOOKID" valueComputed="(select BOOKID from LIB_BOOKS where ISBN = '978-5-00108-639-0')"/>
            <column name="AUTHORID" valueComputed="(select AUTHORID from LIB_AUTHORS where LASTNAME = 'Жуковский' AND FIRSTNAME = 'Василий' AND MIDDLENAME = 'Андреевич')"/>
        </insert>

    </changeSet>

    <changeSet id="1.0.1-BookAuthorLink_978-5-00108-639-0_3" author="aelshin">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT
                  COUNT(*)
                FROM
                  LIB_BOOKAUTHORLINKS
                WHERE 1=1
                  AND BOOKID in (select BOOKID from LIB_BOOKS where ISBN = '978-5-00108-639-0')
                  AND AUTHORID in (select AUTHORID from LIB_AUTHORS where LASTNAME = 'Аксаков' AND FIRSTNAME = 'Сергей' AND MIDDLENAME = 'Тимофеевич')
            </sqlCheck>
        </preConditions>

        <insert tableName="LIB_BOOKAUTHORLINKS">
            <column name="BOOKID" valueComputed="(select BOOKID from LIB_BOOKS where ISBN = '978-5-00108-639-0')"/>
            <column name="AUTHORID" valueComputed="(select AUTHORID from LIB_AUTHORS where LASTNAME = 'Аксаков' AND FIRSTNAME = 'Сергей' AND MIDDLENAME = 'Тимофеевич')"/>
        </insert>

    </changeSet>

</databaseChangeLog>